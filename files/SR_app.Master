<%@ Master Language="C#" AutoEventWireup="true" CodeBehind="SR_app.master.cs" Inherits="JG_Prospect.Sr_App.SR_app" %>

<%@ Register Assembly="AjaxControlToolkit" Namespace="AjaxControlToolkit" TagPrefix="ajaxToolkit" %>
<%@ Register Src="~/Sr_App/SRAppHeader.ascx" TagName="Header" TagPrefix="uc1" %>
<%@ Register Src="~/Sr_App/LeftPanel.ascx" TagName="LeftPanel" TagPrefix="uc2" %>
<%@ Register Assembly="AjaxControlToolkit" Namespace="AjaxControlToolkit.HTMLEditor"
    TagPrefix="cc1" %>
<%@ Register Src="~/UserControl/ucRenewSession.ascx" TagPrefix="uc1" TagName="ucRenewSession" %>
<%@ Register Src="~/Controls/_UserGridPhonePopup.ascx" TagPrefix="uc1" TagName="_UserGridPhonePopup" %>
<%
    string baseUrl = HttpContext.Current.Request.Url.Scheme +
                            "://" + HttpContext.Current.Request.Url.Authority +
                            HttpContext.Current.Request.ApplicationPath.TrimEnd('/') + "/";

%>
<!DOCTYPE html>
<html data-ng-app="JGApp">
<head id="Head1" runat="server">
    <title>JG Sales</title>

    <link href="../css/screen.css?v=<%# JG_Prospect.Common.modal.SingletonGlobal.Instance.RandomGUID %>" rel="stylesheet" media="screen" type="text/css" />
    <link href="../css/jquery.ui.theme.css" rel="stylesheet" media="screen" type="text/css" />
    <%--<link rel="stylesheet" type="text/css" href="https://twitter.github.com/bootstrap/assets/css/bootstrap.css">--%>
    <%--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css">--%>
    <%--<link href="../css/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/solid.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/fontawesome.css">--%>

    <link href="../Content/web-fonts-with-css/css/fa-solid.min.css" rel="stylesheet" />
    <link href="../Content/web-fonts-with-css/css/fontawesome.min.css" rel="stylesheet" />

    <link href="../js/mention/recommended-styles.css?v=<%#RandomGUID %>" rel="stylesheet" />
    <%--<link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.21/themes/redmond/jquery-ui.css" />--%>

    <%--<link href="../datetime/js/jquery.ptDayOnlySelect.css" rel="stylesheet" type="text/css" />
    <link href="../datetime/js/jquery.ptTimeOnlySelect.css" rel="stylesheet" type="text/css" />--%>


    <%--<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.1/themes/base/jquery-ui.css" />--%>
    <link href="../css/jquery-ui.css" rel="stylesheet" />

    <link href="../Content/paging.css?v=<%# JG_Prospect.Common.modal.SingletonGlobal.Instance.RandomGUID %>" rel="stylesheet" />

    <script src="../Scripts/jquery-2.2.4.min.js"></script>

    <script type="text/javascript" src="../js/jquery.watermarkinput.js"></script>
    <script src="../js/jquery-ui.js"></script>

    <script type="text/javascript" src="../js/ddaccordion.js"></script>

    <script type="text/javascript" src="../js/jg-common.js?v=<%# JG_Prospect.Common.modal.SingletonGlobal.Instance.RandomGUID %>"></script>

    <link href="../js/tribute/tribute.css" rel="stylesheet" />
    <script src="../js/tribute/tribute.min.js"></script>

    <script type="text/javascript" src="../js/jquery.form.js"></script>
    <script src="/ckeditor/ckeditor.js"></script>
    <script type="text/javascript" src="../js/common-js.js?v=<%# JG_Prospect.Common.modal.SingletonGlobal.Instance.RandomGUID %>"></script>
    <script type="text/javascript" src="../js/paging.js?v=<%# JG_Prospect.Common.modal.SingletonGlobal.Instance.RandomGUID %>"></script>


    <script src="../Scripts/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular-sanitize.js"></script>


    <script type="text/javascript">


        $(function () {
            try {
                if ($('#tabs').length) {
                    $('#tabs').tabs();
                }
            } catch (e) { }
        });

        function isfax(e) {
            var k;
            document.all ? k = e.keyCode : k = e.which;
            return ((k == 40) || (k == 41) || (k == 45) || (k >= 48 && k <= 57) || k == 8 || k == 32 || (k == 46));

        }

        function isAlphaKey(e) {
            var k;
            document.all ? k = e.keyCode : k = e.which;
            return ((k > 64 && k < 91) || (k > 96 && k < 123) || k == 8 || k == 32 || (k == 46));
        }
        function isNumericKey(e) {
            var k;
            document.all ? k = e.keyCode : k = e.which;
            return ((k >= 48 && k <= 57) || (k == 46) || k == 8 || k == 32);
        }
        //        function Numeric(txtName) 
        //          {
        ////        if (txtName.value != '' && txtName.value.match(/[^a-zA-Z]+$/) == null) {
        //            txtName.value = txtName.value.replace(/[A-Za-z\W]/g, '');
        //        

        //    }
        //        
        //        function Alpha(txtName) {

        ////                if (txtName.value != '' && txtName.value.match(/[^0-9]+$/) == null) {
        //            txtName.value = txtName.value.replace(/[0-9]/g, '');

        //        }
    </script>
    <style type="text/css">
        .header-msg {
            min-height: 158px;
        }

        .seq-number-fixed {
            width: 120px;
        }

        .seq-taskid-fixed {
            /*width: 130px;*/
            width: 70px;
        }

        .seq-tasktitle-fixed {
            width: 256px;
            word-wrap: break-word;
        }

        .seq-taskstatus-fixed {
            width: 150px;
        }

        .seq-taskduedate-fixed {
            width: 100px;
        }

        .seq-notes-fixed {
            width: 40%;
        }

        .seq-notes-fixed {
            width: 33%;
        }

        .orange {
            background-color: orange;
            color: black;
        }

        .yellow {
            background-color: yellow;
            color: black;
        }

            .yellow span.parent-task-title {
                color: red;
            }

        .gray {
            background-color: Gray;
        }

        .red {
            background-color: red;
            color: white;
        }

            .red span.parent-task-title {
                color: white;
            }

        .black {
            background-color: black;
            color: white;
        }

            .black span.parent-task-title {
                color: red;
            }

        .lightgray {
            background-color: lightgray;
        }

        .green {
            background-color: green;
            color: white;
        }

            .green span.parent-task-title {
                color: white;
            }

        .defaultColor {
            background-color: #F6F1F3;
        }

        .ui-widget-header {
            border: 0;
            background: none /*{bgHeaderRepeat}*/;
            color: #222 /*{fcHeader}*/;
        }

        .btn_poup {
            float: right;
        }

            .btn_poup input {
                background: #B85250;
                padding: 10px;
                margin-top: 10px;
                color: #FFF;
                border-radius: 5px;
                border: 1px solid #e5e5e5;
                cursor: pointer;
            }

        #phoneDashboardDiv {
            position: fixed;
            bottom: 0;
            right: 2%;
            background-color: #fff;
            color: #7F7F7F;
            padding: 20px;
            border: 2px solid #ccc;
            -moz-border-radius: 20px;
            -webkit-border-radius: 20px;
            -khtml-border-radius: 20px;
            -moz-box-shadow: 0 1px 5px #333;
            -webkit-box-shadow: 0 1px 5px #333;
            z-index: 101;
            width: 900px;
            height: 525px;
        }

            #phoneDashboardDiv .phone_dashbaord {
                cursor: move;
            }


            #phoneDashboardDiv h1 {
                border-bottom: 1px dashed #7F7F7F;
                margin: -20px -20px 0px -20px;
                font-size: 16px;
                padding: 8px;
                height: 20px;
                line-height: 20px;
                background-color: #FFEFEF;
                color: #fff;
                -moz-border-radius: 20px 20px 0px 0px;
                -webkit-border-top-left-radius: 20px;
                -webkit-border-top-right-radius: 20px;
                -khtml-border-top-left-radius: 20px;
                -khtml-border-top-right-radius: 20px;
            }

        .clsPhoneLink {
            cursor: pointer;
        }

        a.boxclose {
            float: right;
            margin-top: -30px;
            margin-right: -30px;
            cursor: pointer;
            color: #fff;
            border: 1px solid #AEAEAE;
            border-radius: 30px;
            background: #605F61;
            font-size: 31px;
            font-weight: bold;
            display: inline-block;
            line-height: 0px;
            padding: 11px 3px;
            text-decoration: none;
        }

        .boxclose:before {
            content: "×";
        }


        #ScriptEditor_ctl01_ctl00, #ScriptEditor_ctl01_ctl01, #ScriptEditor_ctl01_ctl11, #ScriptEditor_ctl01_ctl15, #ScriptEditor_ctl01_ctl18, #ScriptEditor_ctl01_ctl20,
        #ScriptEditor_ctl01_ctl26, #ScriptEditor_ctl01_ctl27, #ScriptEditor_ctl01_ctl28, #ScriptEditor_ctl01_ctl29, #ScriptEditor_ctl01_ctl30, #ScriptEditor_ctl01_ctl35,
        #ScriptEditor_ctl01_ctl45, #ScriptEditor_ctl01_ctl46, #ScriptEditor_ctl01_ctl47, #ScriptEditor_ctl01_ctl48, #ScriptEditor_ctl01_ctl10, #ScriptEditor_ctl01_ctl19,
        #ScriptEditor_ctl01_ctl25, #ScriptEditor_ctl01_ctl09 {
            display: none !important;
        }

        #btnNewScript {
            position: fixed;
            bottom: 4%;
            right: 4%;
        }

        .cls_textbox {
            float: left;
            margin-top: 5px;
            margin-bottom: 5px;
        }

            .cls_textbox input {
                height: 15px;
                padding: 5px;
            }

        #ScriptEditor_ctl02_ctl00 {
            height: 100px !important;
        }

        @keyframes blink {
            from {
                background-color: #fff;
            }

            to {
                background-color: #e0b900;
            }
        }

        @-webkit-keyframes blink {
            from {
                background-color: #fff;
            }

            to {
                background-color: #e0b900;
            }
        }

        .blink-notes {
            animation: blink 2s steps(2, start) infinite;
        }
        .dark-bg{
            display: none;
            position: fixed;
            z-index: 100;
            padding-top: 100px;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0,0,0);
            background-color: rgba(0,0,0,0.4);
        }
    </style>
    <asp:ContentPlaceHolder ID="head" runat="server">
    </asp:ContentPlaceHolder>

    <script type="text/javascript">



        //Enter domain of site to search.
        var domainroot = "www.google.com"

        function Gsitesearch(curobj) {
            curobj.q.value = "site:" + domainroot + " " + curobj.ctl00$qfront.value
        }


        $(function () {

            //On UpdatePanel Refresh
            //debugger;
            var prm = Sys.WebForms.PageRequestManager.getInstance();
            if (prm != null) {
                // debugger;
                prm.add_beginRequest(function (sender, e) {
                    if (sender._postBackSettings.panelsToUpdate != null) {
                        $(".loading").show();
                    }
                });
                prm.add_endRequest(function (sender, e) {
                    $(".loading").hide();
                });
            };

            $('#boxclose').click(function () {
                $('#phoneDashboardDiv').hide();
                $("#divScriptLinks").show();
                $("#scriptDiv").hide();
                BackToPhoneScripts();
            });
        });

        function GetPhoneDiv() {
            $("#ifsoftphone").attr('src', '../Communication/webphone/softphone.html');
            $("#phoneDashboardDiv").show();

        }

        //Bind Scripts into POPUP
        function BindScripts(strScriptId) {

            $.ajax({
                type: "POST",
                url: "/Sr_App/home.aspx/GetAllScripts",
                contentType: "application/json; charset=utf-8",
                dataType: "JSON",
                asynch: false,
                data: "{'strScriptId':'" + strScriptId + "'}",
                success: function (data) {

                    var dataInput = JSON.parse(data.d);
                    var strLinks = "";
                    $.each(dataInput, function (key, value) {
                        strLinks += "<li><a class='clsPhoneLink' data-id=" + value.intScriptId + " onClick = 'GetScriptById(this)'>" + value.strScriptName + "</a></li>";
                    });
                    $("#ulScriptLinks").html(strLinks);
                },
                error: function (a, b, c) {
                    console.log(a);
                }
            });
        }

        function DeleteScript() {

            $.ajax({
                type: "POST",
                url: "home.aspx/ManageScripts",
                contentType: "application/json; charset=utf-8",
                dataType: "JSON",
                data: "{intMode:'" + 3 + "', intScriptId:'" + $("#hdnScriptId").val() + "', strScriptName:'" + $("#txtScriptName").val() + "', strScriptDescription:'" + $find("ScriptEditor").get_content() + "'}",
                success: function (data) {

                    $("#scriptDiv").hide();
                    var dataInput = JSON.parse(data.d);
                    var strLinks = "";
                    $.each(dataInput, function (key, value) {
                        strLinks += "<li><a class='clsPhoneLink' data-id=" + value.intScriptId + " onClick = 'GetScriptById(this)'>" + value.strScriptName + "</a></li>";
                    });
                    $("#ulScriptLinks").html(strLinks);
                    $("#divScriptLinks").show();
                }
            });
        }

        function SubmitScript() {
            var intMode = 0;
            if ($('#btnSubmitScript').attr("value") == "Add") {
                intMode = 1;
            }
            else if ($('#btnSubmitScript').attr("value") == "Update") {
                intMode = 2;
            }

            $.ajax({
                type: "POST",
                url: "home.aspx/ManageScripts",
                contentType: "application/json; charset=utf-8",
                dataType: "JSON",
                data: "{intMode:'" + intMode + "', intScriptId:'" + $("#hdnScriptId").val() + "', strScriptName:'" + $("#txtScriptName").val() + "', strScriptDescription:'" + $find("ScriptEditor").get_content() + "'}",
                success: function (data) {

                    $("#scriptDiv").hide();
                    var dataInput = JSON.parse(data.d);
                    var strLinks = "";
                    $.each(dataInput, function (key, value) {
                        strLinks += "<li><a class='clsPhoneLink' data-id=" + value.intScriptId + " onClick = 'GetScriptById(this)'>" + value.strScriptName + "</a></li>";
                    });
                    $("#ulScriptLinks").html(strLinks);
                    $("#divScriptLinks").show();
                }
            });
        }

        function GetScriptById(e, flagInput) {

            $("#divScriptLinks").hide();
            $("#scriptDiv").show();

            if (flagInput != 0) {
                $.ajax({
                    type: "POST",
                    url: "home.aspx/GetAllScripts",
                    contentType: "application/json; charset=utf-8",
                    dataType: "JSON",
                    data: "{'strScriptId':'" + $(e).attr("data-id") + "'}",
                    success: function (data) {

                        var result = JSON.parse(data.d)[0];
                        $("#hdnScriptId").val(result.intScriptId);
                        $("#txtScriptName").val(result.strScriptName)
                        $find("ScriptEditor").set_content(result.strScriptDescription)
                    }
                });
                $("#btnDeleteScript").show();
                $("#btnSubmitScript").prop('value', 'Update');
            }
            else {
                $("#hdnScriptId").val(0);
                $("#txtScriptName").val("");
                $find("ScriptEditor").set_content("");
                $("#btnDeleteScript").hide();
                $("#btnSubmitScript").prop('value', 'Add');
            }
        }

        function LoadAllScripts() {
            $("#divPhoneScripts").hide();
            BindScripts(0);
            $("#divScriptLinks").show();
        }

        function BackToPhoneScripts() {

            $("#divPhoneScripts").show();
            $("#divScriptLinks").hide();
        }

        function BackToScriptList() {
            $("#scriptDiv").hide();
            $("#divScriptLinks").show();
        }

    </script>

</head>
<body>
    <form id="form1" runat="server">

        <%--Fake fields are a workaround for chrome autofill getting the wrong fields--%>
        <div style="position: fixed; top: -999px; left: -999px;">
            <input type="text" name="fakeusernameremembered" />
            <input type="password" name="fakepasswordremembered" />
        </div>
        <%--Fake fields are a workaround for chrome autofill getting the wrong fields--%>
        <ajaxToolkit:ToolkitScriptManager ID="ToolkitScriptManager1" runat="server" AsyncPostBackTimeout="360000">
            <Services>
                <%-- <asp:ServiceReference Path="~/SuggestSearch.asmx" />--%>
            </Services>
        </ajaxToolkit:ToolkitScriptManager>
        <%-- <asp:ScriptManager ID="scriptmanager1" EnablePageMethods="true" runat="server">
    </asp:ScriptManager>--%>
        <div class="container">
            <!--header section-->
            <div class="header" runat="server" id="mainheader">

                <uc1:Header ID="Header1" runat="server" />
                <div class="search_google">
                    <input name="qfront" id="qfront" value="Google Web Search" runat="server" type="text" /><asp:Button ID="searchbutton"
                        runat="server" value="Search" Text="Search" />
                </div>
                <div style="top: 150px; right: 0px; position: absolute;">
                    <uc1:ucRenewSession runat="server" ID="ucRenewSession" />
                </div>
            </div>
            <div class="content_panel">
                <div class="dark-bg" onclick="toggleMenu(this)"></div>
                <div class="left_panel" id="leftmenudiv" runat="server">
                    <div class="arrowlistmenu">
                        <h4>Customer</h4>
                        <uc2:LeftPanel ID="LeftPanel1" runat="server" />
                        <br />
                        <ul class="left_nav">
                            <li><a id="hypEmail" runat="server" target="_blank">Email</a></li>
                            <li><a href="ShowResources.aspx">Resources</a></li>
                            <li><a href="#">ADMIN </a>
                                <ul>
                                    <li id="li_addresources" runat="server"><a href="AddResources.aspx">Add Resources </a></li>
                                    <%--<asp:linkbutton ID="btnadd" runat="server" 
                                    Text="Add Resources" onclick="btnadd_Click" />--%>
                                    <li id="li_procurement" runat="server"><a href="Procurement.aspx">Procurement</a></li>
                                    <li id="li_statusoverride" runat="server"><a href="StatusOverride.aspx" runat="server">Sr Sales Customer List</a></li>
                                    <li id="li_pricecontrol" runat="server"><a href="~/Sr_App/Price_control.aspx" runat="server" id="A1">Price Control</a></li>
                                    <%-- <li><a id="A2" href="~/Sr_App/InstallCreateUser.aspx" runat="server">InstallUser</a> </li>
                           <li><a id="A3" href="~/Sr_App/EditInstallUser.aspx" runat="server">EditInstallUser</a> </li>--%>
                                    <li id="li_hrreports" runat="server"><a href="~/Sr_App/HRReports.aspx" runat="server">Human Resource</a></li>
                                    <li id="li_installcreateprospect" runat="server"><a href="~/Sr_App/InstallCreateProspect.aspx" runat="server">Install Prospect</a></li>
                                    <li id="li_statusemailtemplate" runat="server" visible="false"><a href="#" runat="server">Email Templates</a></li>
                                    <li id="li_department" runat="server"><a href="~/Sr_App/DepartmentList.aspx" runat="server">Department</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="loading" style="display: none">Loading&#8230;</div>
                <asp:ContentPlaceHolder ID="ContentPlaceHolder1" runat="server">
                </asp:ContentPlaceHolder>
                <div class="clr">
                </div>
            </div>
        </div>
        <!--footer section-->
        <div class="footer_panel">
            <ul>
                <li>&copy; 2012 JG All Rights Reserved.</li>
                <li><a href="#">Terms of Use</a></li>
                <li>|</li>
                <li><a href="#">Privacy Policy</a></li>
            </ul>
        </div>
        <div id="phoneDashboardDiv" style="display: none;">
            <a class="boxclose" id="boxclose"></a>
            <h1 class="phone_dashbaord">Phone Dashboard</h1>
            <table>
                <tr>
                    <td width="50%" style="vertical-align: top;">
                        <div id="divPhone">
                            <iframe id="ifsoftphone" height="450" width="400"></iframe>
                        </div>
                    </td>
                    <td style="vertical-align: top;">
                        <div id="divPhoneScripts">
                            <ul>
                                <li><a class="clsPhoneLink" onclick="LoadAllScripts()">Phone Script</a></li>
                            </ul>
                        </div>
                        <div id="divScriptLinks" style="display: none;">
                            <a class="clsPhoneLink" onclick="BackToPhoneScripts()">&lt;&lt;Back</a>
                            <ul id="ulScriptLinks">
                                <%--<li><a class="clsPhoneLink"></a>Phone Script</li>
                <li>Welcome Script</li>
                <li>Thanks Script</li>--%>
                            </ul>
                            <span class="btn_poup">
                                <input type="button" id="btnNewScript" runat="server" value="Add" tabindex="31" onclick="GetScriptById(this, 0)" />
                            </span>
                        </div>
                        <div id="scriptDiv" style="display: none">
                            <input id="hdnScriptId" type="hidden" />
                            <div class="cls_textbox">
                                Script Name:
                    <input type="text" id="txtScriptName" runat="server" />
                            </div>
                            <cc1:Editor ID="ScriptEditor" runat="server" />
                            <span class="btn_poup">
                                <input type="button" id="btnSubmitScript" runat="server" value="Submit" onclick="SubmitScript()" />
                                <input type="button" id="btnDeleteScript" runat="server" value="Delete" onclick="DeleteScript()" />
                                <input type="button" id="btnCancelScript" runat="server" value="cancel" onclick="BackToScriptList()" />
                            </span>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
    </form>

    <script src="../js/jquery-ui.js"></script>
    <script type="text/javascript" src="//maps.googleapis.com/maps/api/js?key=AIzaSyD0X4v7eqMFcWCR-VZAJwEMfb47id9IZao"></script>
    <script type="text/JavaScript" src="../Communication/webphone/js/linkify/linkify.js"></script>
    <link href="../css/chosen.css" rel="stylesheet" />

    <%--<script type="text/javascript" src="<%=Page.ResolveUrl("~/js/chosen.jquery.js")%>"></script>
    <link href="../Controls/user-grid.css?v=<%= JG_Prospect.Common.modal.SingletonGlobal.Instance.RandomGUID %>" rel="stylesheet" />
    <script src="../js/angular/scripts/Phone.js?v=<%= JG_Prospect.Common.modal.SingletonGlobal.Instance.RandomGUID %>"></script>--%>


    <script type="text/javascript">
        $(function () {

            $("#phoneDashboardDiv").draggable({
                handle: '.phone_dashbaord'
            });
            $("#phoneDashboardDiv").resizable({
                handles: 'n, e, s, w, ne, se, sw, nw'
            });

        });
        function downloadfile(filename, originalfilename) {

            var url = "taskattachmentdownload.aspx?file=" + filename.trim() + "&Ofile=" + originalfilename.trim();

            alert('downloading from ' + url);
            $.fileDownload(url, {});

            return false; //this is critical to stop the click event which will trigger a normal file download!            

        }
        $('#searchbutton').click(function () {
            var search_result = $('#qfront').val();
            window.open('https://www.google.com/search?q=' + search_result);

        });
        $(".tableClass tr:even").addClass('even'); //Tables odd & Even
        $(".tableClass tr:odd").addClass('odd');
        $(".drpVendorName").change(function () {

            $(".tableClass tr:even").addClass('even'); //Tables odd & Even
            $(".tableClass tr:odd").addClass('odd');
            //alert("test");
        });

        $('#qfront') //search function
       .bind('focus', function () {
           var $this = $(this);
           if ($this.val() == 'Google Web Search') {
               $this.val('');
           }
       })
       .bind('blur', function () {
           var $this = $(this);
           if ($this.val() == '') {
               $this.val('Google Web Search');
           }
       });

        function ShowAjaxLoader() {
            $('.loading').show();
        }

        function HideAjaxLoader() {
            $('.loading').hide();
        }

        function CallJGWebServiceCommon(strWebMethod, objPostDataJSON, OnSuccessCallBack, OnErrorCallBack) {
            $.ajax
            (
                {
                    url: '/WebServices/JGWebService.asmx/' + strWebMethod,
                    contentType: 'application/json; charset=utf-8;',
                    type: 'POST',
                    dataType: 'json',
                    data: JSON.stringify(objPostDataJSON),
                    asynch: false,
                    success: function (data) {
                        HideAjaxLoader();
                        if (typeof (OnSuccessCallBack) === 'function') {
                            OnSuccessCallBack(data);
                        }
                    },
                    error: function (a, b, c) {
                        HideAjaxLoader();
                        if (typeof (OnErrorCallBack) === 'function') {
                            OnErrorCallBack(a, b, c);
                        }
                    }
                }
            );
        }

    </script>
    <div class="phone-dashboard">
        <div class="header">
            <span class="popup-title">Phone / Vmail Dashboard</span>
            <span class="close" onclick="closePhonePopup(this)"><i class="fa fa-times-circle" aria-hidden="true"></i></span>
            <span class="min-max" onclick="minMaxPhone(this)"><i class="fa fa-window-minimize" aria-hidden="true"></i></span>
            <span class="fullscreen-btn" onclick="minMaxPhone(this)"><i class="fa fa-window-maximize" aria-hidden="true"></i></span>
        </div>
        <div class="content-area">
            <iframe src=""></iframe>
        </div>
    </div>
    <div id="MainThrobberImage" style="position: absolute; z-index: 99999999999999; display: none;">
        <img alt="throbber" src="../img/ajax-loader.gif" />
    </div>
    <div class="telecom-dashboard-popup fullscreen-chat">
        <span class="data" style="display: none;"></span>
        <input type="hidden" class="size" />
        <input type="hidden" class="type" />
        <input type="hidden" class="width" />
        <input type="hidden" class="height" />
        <input type="hidden" id="imageBase64" />
        <div class="header">
            <span class="popup-title">Chat Dashboard</span>
            <span class="close" onclick="closeTelecomPopup(this)"><i class="fa fa-times-circle" aria-hidden="true"></i></span>
            <span class="min-max" onclick="minMax(this)"><i class="fa fa-window-minimize" aria-hidden="true"></i></span>
            <span class="fullscreen-btn" onclick="fullscreen(this)"><i class="fa fa-window-maximize" aria-hidden="true"></i></span>
            <input type="hidden" id="ChatSourceId" />
        </div>
        <div class="content-area">
            <div class="column1">
                <div class="dialer-section">
                    <div class="header">
                        <span class="group-name">Phone / VMail Dashboard</span>
                        <span class="minimize" onclick="minimizePhone(this)">
                            <img src="../img/min-max.jpg"></span>
                    </div>
                    <div id="wrapper">
                        <div id="phone">
                            <div class="col-md-4 phone">
                                <div class="row1">
                                    <input type="hidden" id="appSettings" />
                                    <div class="col-md-12 white-shadow">
                                        <input type="text" name="name" onkeyup="trimSpace(this)" onblur="trimSpace(this)" id="toNumber" class="form-control tel" placeholder="+91801XXXXXXX" value="" />
                                        <div class="num-pad">
                                            <div class="span4">
                                                <div class="num">
                                                    <div class="txt">
                                                        1
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="span4">
                                                <div class="num">
                                                    <div class="txt">
                                                        2 <span class="small">
                                                            <p>
                                                                ABC
                                                            </p>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="span4">
                                                <div class="num">
                                                    <div class="txt">
                                                        3 <span class="small">
                                                            <p>
                                                                DEF
                                                            </p>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="span4">
                                                <div class="num">
                                                    <div class="txt">
                                                        4 <span class="small">
                                                            <p>
                                                                GHI
                                                            </p>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="span4">
                                                <div class="num">
                                                    <div class="txt">
                                                        5 <span class="small">
                                                            <p>
                                                                JKL
                                                            </p>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="span4">
                                                <div class="num">
                                                    <div class="txt">
                                                        6 <span class="small">
                                                            <p>
                                                                MNO
                                                            </p>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="span4">
                                                <div class="num">
                                                    <div class="txt">
                                                        7 <span class="small">
                                                            <p>
                                                                PQRS
                                                            </p>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="span4">
                                                <div class="num">
                                                    <div class="txt">
                                                        8 <span class="small">
                                                            <p>
                                                                TUV
                                                            </p>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="span4">
                                                <div class="num">
                                                    <div class="txt">
                                                        9 <span class="small">
                                                            <p>
                                                                WXYZ
                                                            </p>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="span4">
                                                <div class="num">
                                                    <div class="txt">
                                                        *
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="span4">
                                                <div class="num">
                                                    <div class="txt">
                                                        0 <span class="small">
                                                            <p>
                                                                +
                                                            </p>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="span4">
                                                <div class="num">
                                                    <div class="txt">
                                                        #
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="clearfix">
                                        </div>
                                        <input type="button" id="makecall" class="btn btn-success btn-block flatbtn" value="CALL" />
                                        <input type="button" class="hangup btn btn-danger btn-block flatbtn" value="HANGUP" />
                                    </div>
                                </div>
                                <div class="clearfix">
                                </div>
                            </div>
                            <div class="button-3">
                                <div class="callinfo">
                                    <h4 id="boundType">Fetching...</h4>
                                    <h4 id="callNum">Fetching...</h4>
                                    <h2 id="callDuration">00:00</h2>
                                </div>
                            </div>
                        </div>
                        <div class="dialer-right">
                            <input type="hidden" class="script-data" value="" />
                            <div class="scrips">
                                <div class="tabs">
                                    <div onclick="showhideType(this, 1);">Inbound</div>
                                    <div onclick="showhideType(this, 2);" class="active">Outbound</div>
                                </div>
                                <div class="script-data">
                                    <div class="inner-tabs">
                                    </div>
                                    <div class="content"></div>
                                    <div class="content-right"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <%--<div class="user-list-section">
                    <img src="../img/user-list.PNG" />
                </div>--%>
            </div>
            <div class="column2">
                <div class="email-section">
                    <div class="header">
                        <span class="group-name">Email Dashboard</span>
                        <span class="minimize" onclick="minimizeEmail(this)">
                            <img src="../img/min-max.jpg"></span>
                    </div>
                    <%--<img src="../img/inbox.PNG" />--%>
                    <iframe id="iframe-inbox" src="/email/default.aspx"></iframe>
                </div>
                <div class="chat-section">
                    <div class="chat-container" id="chat-container">
                        <div class="all-chats">
                        </div>
                    </div>
                </div>
            </div>
            <div class="column3">
                <div class="email-compose-section">
                    <%--<img src="../img/compose.PNG" />--%>
                </div>
                <div class="chat-users-section">
                    <div class="header">Contacts</div>
                    <div class="list">
                        Loading Online Users...
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="overlay">
    </div>
    <audio controls="controls" class="chat-notification-sound">
        <source src="../Chat/chat-notification.mp3" />
        <source src="../Chat/chat-notification.ogg" />
    </audio>
    <script src="../js/jquery.caret.js"></script>
    <%--<script src="../js/jquery.dialogextend.min.js"></script>--%>
    <link href="../Chat/chat.css?v=<%= JG_Prospect.Common.modal.SingletonGlobal.Instance.RandomGUID %>" rel="stylesheet" />
    <script src="/Scripts/jquery.signalR-2.2.2.min.js"></script>
    <script src="/signalr/hubs"></script>

    <script src='//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js' type='text/javascript'></script>
    <link href="../js/Jquery-mention/jquery.mentionsInput.css" rel="stylesheet" />
    <script src='../js/Jquery-mention/lib/jquery.events.input.js' type='text/javascript'></script>
    <script src='../js/Jquery-mention/lib/jquery.elastic.js' type='text/javascript'></script>
    <script src='../js/Jquery-mention/jquery.mentionsInput.js' type='text/javascript'></script>

    <!-- Begin emoji-picker Stylesheets -->
    <link href="../Content/emoji-picker/lib/css/emoji.css" rel="stylesheet">
    <!-- End emoji-picker Stylesheets -->
    <!-- Begin emoji-picker JavaScript -->
    <script src="../Content/emoji-picker/lib/js/config.js"></script>
    <script src="../Content/emoji-picker/lib/js/util.js"></script>
    <script src="../Content/emoji-picker/lib/js/jquery.emojiarea.js"></script>
    <script src="../Content/emoji-picker/lib/js/emoji-picker.js"></script>
    <!-- End emoji-picker JavaScript -->
    <script src="../js/copy-image.js"></script>
    <script type="text/javascript" src="../js/dropzone.js"></script>
    <%--<script type="text/javascript" src="https://s3.amazonaws.com/plivosdk/web/plivo.min.js"></script>--%>
    <script src="https://cdn.plivo.com/sdk/browser/v2/plivo.min.js"></script>
    <script src="../js/button-action.js?v=<%= JG_Prospect.Common.modal.SingletonGlobal.Instance.RandomGUID %>"></script>
    <link href="../Content/dialer-call.css?v=<%= JG_Prospect.Common.modal.SingletonGlobal.Instance.RandomGUID %>" rel="stylesheet">

    <script type="text/javascript">
        // $(document).ready(function () {
        // Reference the auto-generated proxy for the hub.
        var chat = $.connection.chatHub;
        var userTobeAddedIntoUserChatGroupId = 0;
        var userChatStatus = '<%= (int)JG_Prospect.Common.ChatUserStatus.Active %>';
        var pageTitle = $('head').find('title').html();
        sendChat = function (e, sender) {
            if (chat.server == undefined)
                chat = $.connection.chatHub;
            var chatGrpId = $(sender).parents('.chat-box').find('#ChatGroupId').val();
            var receiverIds = $(sender).parents('.chat-box').find('#ReceiverIds').val();
            var chatSourceId = $('#ChatSourceId').val();
            var taskId = $('#TaskId').val();
            var taskMultilevelListId = $('#TaskMultilevelListId').val();
            var userChatGroupId = $('#UserChatGroupId').val();
            if (receiverIds != '' && receiverIds != null && chatSourceId != '' && chatSourceId != null) {
                if ($(sender).hasClass('text-send')) {
                    var chatText = $(sender).parents('div.chat-text').find('.emoji-wysiwyg-editor').html();
                    if (chatText != undefined && chatText != '' && chatText != null) {
                        chat.server.sendChatMessage(chatGrpId, chatText, chatSourceId, receiverIds, null, taskId, taskMultilevelListId, userChatGroupId);
                        $('.emoji-wysiwyg-editor').html('');
                    }
                } else {

                    var charCode = (typeof e.which === "number") ? e.which : e.keyCode;
                    if (charCode === 13) {
                        var ev = $.Event("keydown", { keyCode: 20 });
                        $(sender).trigger(ev);
                        var chatText = $(sender).html();                        
                        $(sender).html('');
                        if (chatText != undefined && chatText != '' && chatText != null) {
                            chat.server.sendChatMessage(chatGrpId, chatText, chatSourceId, receiverIds, null, taskId, taskMultilevelListId, userChatGroupId);
                            $('.emoji-wysiwyg-editor').html('');
                        }
                    }
                }
                userTobeAddedIntoUserChatGroupId = userChatGroupId;
            }
        }
        minimize = function (sender) {
            if ($(sender).parents('.telecom-dashboard-popup').hasClass('fullscreen-chat')) {
                $(sender).parents('.telecom-dashboard-popup').removeClass('fullscreen-chat');
                $(sender).parents('.telecom-dashboard-popup').removeClass('fullscreen-email');
                $('.popup-title').html('ALL-Telecom Dashboard');
                $(sender).parents('.telecom-dashboard-popup').find('.call-logs').hide();
            } else {
                $(sender).parents('.telecom-dashboard-popup').addClass('fullscreen-chat');
                $(sender).parents('.telecom-dashboard-popup').removeClass('fullscreen-email');
                $(sender).parents('.telecom-dashboard-popup').find('.call-logs').hide();
                $('.popup-title').html('Chat Dashboard');
            }
        }
        closechat = function (sender) {
            if (chat.server == undefined)
                chat = $.connection.chatHub;
            chat.server.closeChat($(sender).parents('.chat-box').attr('id'));
            $(sender).parents('.chat-box').remove();
            if (window.location.href.toLowerCase().indexOf('edituser.aspx') > 1)
                ReLoadNotes();
        }
        closeTelecomPopup = function (sender) {
            if (chat.server == undefined)
                chat = $.connection.chatHub;
            var taskId = $(sender).parents('.telecom-dashboard-popup').find('#TaskId').val();
            var taskMultilevelListId = $(sender).parents('.telecom-dashboard-popup').find('#TaskMultilevelListId').val();
            var receiverIds = $(sender).parents('.telecom-dashboard-popup').find('#ReceiverIds').val();
            var chatGroupId = $(sender).parents('.telecom-dashboard-popup').find('#ChatGroupId').val();
            chat.server.closeChat($(sender).parents('.telecom-dashboard-popup').find('.chat-box').attr('id'));
            $(sender).parents('.telecom-dashboard-popup').hide();
            $('.overlay').hide();
            if (window.location.href.toLowerCase().indexOf('itdashboard') > 0) {
                var container = $('.notes-section[taskid="' + taskId + '"]').filter('div[taskmultilevellistid="' + taskMultilevelListId + '"]').find('.note-list');
                LoadNotes(container, taskId, taskMultilevelListId);
            }
        }
        addUserIntoChatGroup = function (id) {
            if (chat.server == undefined)
                chat = $.connection.chatHub;
            var chatGroupId = $('.telecom-dashboard-popup').find('#ChatGroupId').val();
            var userChatGroupId = $('.telecom-dashboard-popup').find('#UserChatGroupId').val();
            var existingUsers = $('.telecom-dashboard-popup').find('#ReceiverIds').val();
            chat.server.addUserIntoChatGroup(chatGroupId, id, userChatGroupId);
            userTobeAddedIntoUserChatGroupId = 0;
        }
        // Start the connection.
        //$.connection.hub.logging = true;
        $.connection.hub.start().done(function () {
            console.log('started...');
            GetOnlineUsers();
            //GetChatUnReadCount();
            //chat.server.getOnlineChatUsers();
            // logic to open chat popup as per query string
            var RcvrID = getUrlVars()["RcvrID"];
            var chatGroupId = getUrlVars()["CGID"];
            if (RcvrID != undefined && chatGroupId != undefined)
                InitiateChat($('.left_panel'), RcvrID, chatGroupId, '<%=(int)JG_Prospect.Common.ChatSource.UserChat%>', 0, 0, 0);
        }).fail(function (reason) {
            debugger;
            console.log(reason);
        });
        $.connection.hub.disconnected(function () {
            console.log('Disconnected');
            setTimeout(function () {
                console.log('Reconnecting...');
                $.connection.hub.start();
            }, 5000); // Restart connection after 5 seconds.
        });
        chat.client.sendChatMessageCallbackError = function (data) {
            console.log(data.Object);
        };
        //Callback function which the hub will call when it has finished processing,
        // is attached to the proxy
        chat.client.updateClient = function (data) {
            var id = data.Message.split('`')[0];
            var name = data.Message.split('`')[1];
            var receiverIds = data.Message.split('`')[2];
            var senderId = data.Message.split('`')[3];
            var taskId = data.Message.split('`')[4];
            var taskMultilevelListId = data.Message.split('`')[5];
            var userChatGroupId = data.Message.split('`')[6];
            var chatSourceId = data.Object.ChatSourceId;
            var oldchatId = 'none';
            // Check if other's chat is already open at receiver's end
            if ($('.telecom-dashboard-popup').is(':visible')) {
                oldchatId = $('.telecom-dashboard-popup').find('#ChatGroupId').val();
            }
            if ((id == oldchatId || oldchatId == 'none') && !$('.telecom-dashboard-popup').hasClass('minimize')) {
                var strChat = '<div class="chat-box" id="' + id + '" style="display:block;">' +
                                            '<div class="header"><span class="group-name">' + name +
                                                '</span><span class="close" onclick="closechat(this)"><i class="fa fa-times" aria-hidden="true"></i></span>' +
                                                '<span class="member-list-container"><i class="fas fa-ellipsis-v" aria-hidden="true"></i><div class="member-list"></div></span>' +
                                                '<span class="minimize" onclick="minimize(this)"><img src="../img/min-max.jpg" /></span>' +
                                                '<span class="last-seen" title="last seen"></span></div>' +
                                            '<input type="hidden" id="ChatGroupId" value="' + id + '" />' +
                                            '<input type="hidden" id="TaskId" value="' + taskId + '" />' +
                                            '<input type="hidden" id="TaskMultilevelListId" value="' + taskMultilevelListId + '" />' +
                                            '<input type="hidden" id="ReceiverIds" value="' + receiverIds + '" />' +
                                            '<input type="hidden" id="UserChatGroupId" value="' + userChatGroupId + '" />' +
                                            '<input type="hidden" id="ChatSourceId" value="' + chatSourceId + '" />' +
                                            '<div class="chats watermark-logo"></div>' +
                                            '<div class="chat-text">' +
                                                '<input type="text" data-emojiable="true" class="mention" placeholder="Say Something..." id="chattext" onkeyup="sendChat(event, this);" />' +
                                                '<button class="text-send" onclick="sendChat(event, this)">Send</button>' +
                                                '<div class="file-send">Drop Files</div>' +
                                                '<button class="record-send"><i class="fa fa-microphone" aria-hidden="true"></i></button>' +
                                            '</div>' +
                                       '</div>';
                if ($('.all-chats').find('#' + id) != undefined)
                    if ($('.all-chats').find('#' + id).length <= 0) {
                        $('.all-chats').html(strChat);
                        LoadPreviousChat(this, id, receiverIds + ',' + senderId, chatSourceId, userChatGroupId);
                        InitializeEmoji();
                    }
                GetPhoneScripts(this);
                // Show chat popup
                $('.telecom-dashboard-popup').show();
                $('.overlay').show();
                $('#ChatSourceId').val(chatSourceId);
                // Calculate Center
                var sW = $(window).width();
                var pW = $('.telecom-dashboard-popup').width();
                var sH = $(window).height();
                var pH = $('.telecom-dashboard-popup').height();
                $('.telecom-dashboard-popup').css({ 'left': ((sW / 2) - (pW / 2)) + 'px', 'top': ((sH / 2) - (pH / 2)) + 'px' });
                // Add the message to the page.
                // Identify sender/receiver
                var loggedInUserId = getCookie('<%=JG_Prospect.Common.Cookies.UserId%>');
                var senderReceiver = loggedInUserId == data.Object.UserId ? 'sender' : 'receiver';
                var str = "";
                if (data.Results.length > 0) {
                    $(data.Results).each(function (i) {
                        var msg = data.Results[i].Message;
                        var fileid = data.Results[i].FileId;
                        var previewImage = '<img src="/chat/attachments/' + msg.split(':-:')[1] + '" />';
                        var audioTag = '';
                        if (fileid != undefined && fileid != null && fileid != '') {

                            var fileExt = (msg.split(':-:')[0].split('.').pop()).toLowerCase();
                            switch (fileExt) {
                                case 'xls':
                                case 'xlsx':
                                    previewImage = '<img class="chat-image-preview" src="/chat/previewIcons/excel.png" />';
                                    break;
                                case 'html':
                                case 'html':
                                    previewImage = '<img class="chat-image-preview" src="/chat/previewIcons/html.png" />';
                                    break;
                                case 'pdf':
                                    previewImage = '<img class="chat-image-preview" src="/chat/previewIcons/pdf.png" />';
                                    break;
                                case 'txt':
                                case 'rtf':
                                    previewImage = '<img class="chat-image-preview" src="/chat/previewIcons/text.png" />';
                                    break;
                                case 'doc':
                                case 'docx':
                                    previewImage = '<img class="chat-image-preview" src="/chat/previewIcons/word.png" />';
                                    break;
                                case 'zip':
                                case 'rar':
                                    previewImage = '<img class="chat-image-preview" src="/chat/previewIcons/zip.png" />';
                                    break;
                                case 'mp3':
                                case 'wav':
                                case 'ogg':
                                    audioTag = '<audio controls><source src="/chat/attachments/' + msg.split(':-:')[1] + '"></audio>';
                                    break;
                                case 'mp4':
                                case 'webm':
                                    audioTag = '<video width="320" height="240" controls><source src="/chat/attachments/' + msg.split(':-:')[1] + '"></audio>';
                                    break;
                                case 'png':
                                case 'jpg':
                                case 'bmp':
                                case 'jpeg':
                                case 'gif':
                                    previewImage = '<img src="/chat/attachments/' + msg.split(':-:')[1] + '" />';
                                    break;
                                default:
                                    previewImage = '<img class="chat-image-preview" src="/chat/previewIcons/file.png" />';
                                    break;
                            }
                            if (audioTag != '') {
                                msg = audioTag;
                            } else {
                                msg = '<a href="/chat/attachments/' + msg.split(':-:')[1] + '" target="_black">' +
                                        previewImage +
                                        '</a>';
                            }
                        }
                        if (ValidURL(msg.trim())) {
                            var ext = (msg.split('.').pop()).toLowerCase();
                            switch (ext) {
                                case 'xls':
                                case 'xlsx':
                                    previewImage = '<img class="chat-image-preview" src="/chat/previewIcons/excel.png" />';
                                    break;
                                case 'html':
                                case 'html':
                                    previewImage = '<img class="chat-image-preview" src="/chat/previewIcons/html.png" />';
                                    break;
                                case 'pdf':
                                    previewImage = '<img class="chat-image-preview" src="/chat/previewIcons/pdf.png" />';
                                    break;
                                case 'txt':
                                case 'rtf':
                                    previewImage = '<img class="chat-image-preview" src="/chat/previewIcons/text.png" />';
                                    break;
                                case 'doc':
                                case 'docx':
                                    previewImage = '<img class="chat-image-preview" src="/chat/previewIcons/word.png" />';
                                    break;
                                case 'zip':
                                case 'rar':
                                    previewImage = '<img class="chat-image-preview" src="/chat/previewIcons/zip.png" />';
                                    break;
                                case 'mp3':
                                case 'wav':
                                case 'ogg':
                                    audioTag = '<audio controls><source src="' + msg + '"></audio>';
                                    break;
                                case 'mp4':
                                case 'webm':
                                    audioTag = '<video width="320" height="240" controls><source src="' + msg + '"></audio>';
                                    break;
                                case 'png':
                                case 'jpg':
                                case 'bmp':
                                case 'jpeg':
                                    previewImage = '<img src="' + msg + '" />';
                                    break;
                                default:
                                    previewImage = msg;
                                    break;
                            }
                            if (audioTag != '') {
                                msg = audioTag;
                            } else {
                                msg = '<a href="' + msg + '" target="_black">' +
                                        previewImage +
                                        '</a>';
                            }
                        }
                        str += '<div class="chat-row ' + senderReceiver + '" userid="' + data.Results[i].UserId + '"><div class="profile">' +
                                        '<img src="<%=baseUrl %>' + data.Results[i].UserProfilePic + '" title="' + data.Results[i].UserFullname + '" />' +
                                        '<div class="status-icon"></div><div class="installid">' +
                                            '<a target="_blank" href="/Sr_App/ViewSalesUser.aspx?id=' + data.Results[i].UserId + '">' + data.Results[i].UserInstallId + '</a></div>' +
                                    '</div>' +
                                    '<div class="message"><div class="msg">' + msg + '</div>' +
                                    '<div class="time-container"><div class="tick">' +
                                        '<img src="../img/double-grey-tick.png" /> </div>' +
                                        '<div class="time">' + data.Results[i].MessageAtFormatted + '</div>' +
                                        '<div class="est">(EST)</div> </div>' +
                                    '</div></div>';
                    });
                }
                $('.chat-box#' + id + ' .chats').append(str);
                //$('.chat-box .chats').scrollTop(d.prop("scrollHeight"));
                $('.chat-box#' + id + ' .chats').animate({ scrollTop: $('.chat-box#' + id + ' .chats').prop("scrollHeight") }, 500);

                $('audio.chat-notification-sound').remove();
                if (loggedInUserId != data.Object.UserId) {
                    $('body').append('<audio autoplay class="chat-notification-sound"><source src="../Chat/chat-notification.mp3"><source src="../Chat/chat-notification.ogg"></audio>');
                    PageTitleNotification.Off();
                    PageTitleNotification.On('New Message!!!', 1000);
                    if (chat.server == undefined)
                        chat = $.connection.chatHub;
                    // Mark as Read to this message and notify other users by blue tick only if popup is open & maximize
                    chat.server.setChatMessageRead(id, userChatGroupId);
                }
            }
            GetOnlineUsers();
            fillChatMemberList();
            //GetChatUnReadCount();
        };
        chat.client.addUserIntoChatGroupCallback = function (data) {
            $('.emoji-wysiwyg-editor').html('');
            var id = data.Object.split('`')[0];
            var name = data.Object.split('`')[1];
            var userId = data.Object.split('`')[2];
            var userChatGroupId = data.Object.split('`')[3];
            var receiverIds = $('.chat-box#' + id).find('#ReceiverIds').val().split(',');
            receiverIds.push(userId);
            $('.chat-box#' + id).find('#ReceiverIds').val(receiverIds.join(','));
            $('.chat-box#' + id).find('#UserChatGroupId').val(userChatGroupId);
            $('.chat-box#' + id + ' .chats').append('<div class="newUser">' + data.Message + '</div>');
            $('.chat-box#' + id + ' .header').find('.group-name').html(name);
            $('.chat-box#' + id + ' .chats').animate({ scrollTop: $('.chat-box#' + id + ' .chats').prop("scrollHeight") }, 500);
            fillChatMemberList();
            GetOnlineUsers();
        };
        chat.client.removeChatGroupMemberCallback = function (data) {
            var loggedInUserId = getCookie('<%=JG_Prospect.Common.Cookies.UserId%>');
            $('.emoji-wysiwyg-editor').html('');
            var id = data.Object.split('`')[0];
            var name = data.Object.split('`')[1];
            var userId = data.Object.split('`')[2];
            var userChatGroupId = data.Object.split('`')[3];
            var receiverIds = $('.chat-box#' + id).find('#ReceiverIds').val().split(',');
            var newReceiverIds = [];
            $.each(receiverIds, function (i) {
                if (receiverIds[i] != userId) {
                    newReceiverIds.push(receiverIds[i]);
                }
            });
            if (loggedInUserId == userId) {
                $('.chat-box#' + id).find('.chat-text').remove();
            }
            $('.chat-box#' + id).find('#ReceiverIds').val(newReceiverIds.join(','));
            $('.chat-box#' + id).find('#UserChatGroupId').val(userChatGroupId);
            $('.chat-box#' + id + ' .chats').append('<div class="newUser">' + data.Message + '</div>');
            $('.chat-box#' + id + ' .header').find('.group-name').html(name);
            $('.chat-box#' + id + ' .chats').animate({ scrollTop: $('.chat-box#' + id + ' .chats').prop("scrollHeight") }, 500);
            fillChatMemberList();
            GetOnlineUsers();
        };
        chat.client.leaveGroupCallback = function (data) {
            var loggedInUserId = getCookie('<%=JG_Prospect.Common.Cookies.UserId%>');
            $('.emoji-wysiwyg-editor').html('');
            var id = data.Object.split('`')[0];
            var name = data.Object.split('`')[1];
            var userId = data.Object.split('`')[2];
            var userChatGroupId = data.Object.split('`')[3];
            var receiverIds = $('.chat-box#' + id).find('#ReceiverIds').val().split(',');
            var newReceiverIds = [];
            $.each(receiverIds, function (i) {
                if (receiverIds[i] != userId) {
                    newReceiverIds.push(receiverIds[i]);
                }
            });
            if (loggedInUserId == userId) {
                $('.chat-box#' + id).find('.chat-text').remove();
                $('.member-list-container .member-list').html('');
                $('.member-list-container').hide();
            }
            $('.chat-box#' + id).find('#ReceiverIds').val(newReceiverIds.join(','));
            $('.chat-box#' + id).find('#UserChatGroupId').val(userChatGroupId);
            $('.chat-box#' + id + ' .chats').append('<div class="newUser">' + data.Message + '</div>');
            $('.chat-box#' + id + ' .header').find('.group-name').html(name);
            $('.chat-box#' + id + ' .chats').animate({ scrollTop: $('.chat-box#' + id + ' .chats').prop("scrollHeight") }, 500);
            GetOnlineUsers();
        };
        chat.client.closeChatCallback = function (data) {
            if (data.Object) {
                $('.chat-box#' + data.Message).remove();
            }
        };
        chat.client.onConnectedCallback = function (data) {
            //console.log(data);
            userChatStatus = data.Object;
            GetOnlineUsers();
        }
        chat.client.onDisconnectedCallback = function (data) {
            GetOnlineUsers();
        }
        chat.client.setChatUserStatusToIdleCallback = function (data) {
            bindChatUsers(data);
        }
        chat.client.setChatMessageReadCallback = function (data) {
            SetChatMessageRead(data);
        }

        var timer = null;
        $(document).on('mousemove', function () {
            if (chat.server == undefined)
                chat = $.connection.chatHub;
            if (userChatStatus == '<%= (int)JG_Prospect.Common.ChatUserStatus.Idle %>') {
                chat.server.setChatUserStatusToIdle('<%= (int)JG_Prospect.Common.ChatUserStatus.Active %>');
                userChatStatus = '<%= (int)JG_Prospect.Common.ChatUserStatus.Active %>';
            } else {
                // Reset Timeout
                if (timer) {
                    clearTimeout(timer); //cancel the previous timer.
                    timer = null;
                }
                timer = setTimeout(function () {
                    chat.server.setChatUserStatusToIdle('<%= (int)JG_Prospect.Common.ChatUserStatus.Idle %>');
                    userChatStatus = '<%= (int)JG_Prospect.Common.ChatUserStatus.Idle %>';
                }, 900000);
            }
        });
        $(document).on('cilck', 'img.copy-paste-image', function () {
            var anchor = '<a href="'+$(this)+'" target="_blank"></a>';
        });
        removeMember = function (sender, userId) {
            if (chat.server == undefined)
                chat = $.connection.chatHub;
            chat.server.removeChatGroupMember($('.chat-box').find('#UserChatGroupId').val(), userId, $('.chat-box').find('#ChatGroupId').val());
        }

        leaveGroup = function (sender) {
            if (chat.server == undefined)
                chat = $.connection.chatHub;
            chat.server.leaveGroup($('.chat-box').find('#UserChatGroupId').val(), $('.chat-box').find('#ChatGroupId').val());
        }

        function LoadPreviousChat(sender, chatGroupId, receiverIds, chatSourceId, userChatGroupId) {
            ajaxExt({
                url: '/WebServices/JGWebService.asmx/LoadPreviousChat',
                type: 'POST',
                data: '{ receiverIds: "' + receiverIds + '", chatGroupId:"' + chatGroupId + '", chatSourceId:' + chatSourceId + ',userChatGroupId:' + userChatGroupId + ' }',
                showThrobber: false,
                throbberPosition: { my: "left center", at: "right center", of: $(sender), offset: "5 0" },
                success: function (data, msg) {
                    var loggedInUserId = getCookie('<%=JG_Prospect.Common.Cookies.UserId%>');
                    var str = '';
                    $(data.Results).each(function (i) {
                        var senderReceiver = loggedInUserId == data.Results[i].UserId ? 'sender' : 'receiver';
                        var fileid = data.Results[i].FileId;
                        var msg = data.Results[i].Message;
                        if (fileid != undefined && fileid != null && fileid != '') {
                            msg = '<a href="/chat/attachments/' + msg.split(':-:')[1] + '" target="_black">' + msg.split(':-:')[0] + '</a>';
                        }
                        var tickColor = data.Results[i].IsRead.toString().toLowerCase() == 'true' ? 'double-blue' : 'double-grey';
                        str += '<div class="chat-row ' + senderReceiver + '" userid="' + data.Results[i].UserId + '"><div class="profile">' +
                                        '<img src="<%=baseUrl %>' + data.Results[i].UserProfilePic + '" title="' + data.Results[i].UserFullname + '" />' +
                                        '<div class="status-icon"></div><div class="installid">' +
                                            '<a target="_blank" href="/Sr_App/ViewSalesUser.aspx?id=' + data.Results[i].UserId + '">' + data.Results[i].UserInstallId + '</a></div>' +
                                    '</div>' +
                                    '<div class="message"><div class="msg">' + msg + '</div>' +
                                    '<div class="time-container"><div class="tick">' +
                                        '<img src="../img/' + tickColor + '-tick.png" /> </div>' +
                                        '<div class="time">' + data.Results[i].MessageAtFormatted + '</div>' +
                                        '<div class="est">(EST)</div> </div>' +
                                    '</div></div>';
                    });
                    $('.chat-box#' + chatGroupId + ' .chats').append(str);
                    //$('.chat-box .chats').scrollTop(d.prop("scrollHeight"));
                    $('.chat-box#' + chatGroupId + ' .chats').animate({ scrollTop: $('.chat-box#' + chatGroupId + ' .chats').prop("scrollHeight") }, 500);
                    str = '';
                }
            });
        }

        function InitiateChat(sender, receiverIds, chatGroupId, chatSourceId, taskId, taskMultilevelListId, userChatGroupId) {
            $('#ChatSourceId').val(chatSourceId);
            ajaxExt({
                url: '/WebServices/JGWebService.asmx/InitiateChat',
                type: 'POST',
                data: '{ receiverIds: "' + receiverIds + '", chatGroupId:"' + chatGroupId + '", chatSourceId:' + chatSourceId + ', taskId:' + taskId + ', taskMultilevelListId:' + taskMultilevelListId + ',userChatGroupId:' + userChatGroupId + ' }',
                showThrobber: true,
                throbberPosition: { my: "left center", at: "right center", of: $(sender), offset: "5 0" },
                success: function (data, msg) {
                    // Close Previous Chat
                    var chat = $('.chat-container .chat-box').find('span.close');
                    closechat(chat);
                    var id = data.Object.ChatGroupId;
                    var name = data.Object.ChatGroupName;
                    userChatGroupId = data.Message;
                    if (chat.server == undefined)
                        chat = $.connection.chatHub;
                    // Mark as Read to this message and notify other users by blue tick
                    chat.server.setChatMessageRead(id, userChatGroupId);
                    //$('.chat-container').show();
                    if ($('#' + id).length <= 0) {
                        $('.telecom-dashboard-popup').show();
                        $('.telecom-dashboard-popup').removeClass('minimize');
                        $('.overlay').show();
                        // Calculate Center
                        var sW = $(window).width();
                        var pW = $('.telecom-dashboard-popup').width();
                        var sH = $(window).height();
                        var pH = $('.telecom-dashboard-popup').height();
                        $('.telecom-dashboard-popup').css({ 'left': ((sW / 2) - (pW / 2)) + 'px', 'top': ((sH / 2) - (pH / 2)) + 'px' });
                        window.scrollTo(0, 0);
                        var strChat = '<div class="chat-box" id="' + id + '" style="display:block;">' +
                                            '<div class="header"><span class="group-name">' + name +
                                                '</span><span class="close" onclick="closechat(this)"><i class="fa fa-times" aria-hidden="true"></i></span>' +
                                                '<span class="member-list-container"><i class="fas fa-ellipsis-v" aria-hidden="true"></i><div class="member-list"></div></span>' +
                                                '<span class="minimize" onclick="minimize(this)"><img src="../img/min-max.jpg" /></span>' +
                                                '<span class="last-seen" title="last seen">' + data.Object.LastSeenAtFormated + '</span></div>' +
                                            '<input type="hidden" id="ChatGroupId" value="' + id + '" />' +
                                            '<input type="hidden" id="TaskId" value="' + taskId + '" />' +
                                            '<input type="hidden" id="TaskMultilevelListId" value="' + taskMultilevelListId + '" />' +
                                            '<input type="hidden" id="ReceiverIds" value="' + receiverIds + '" />' +
                                            '<input type="hidden" id="UserChatGroupId" value="' + userChatGroupId + '" />' +
                                            '<input type="hidden" id="ChatSourceId" value="' + chatSourceId + '" />' +
                                            '<div class="chats watermark-logo"></div>' +
                                            '<div class="chat-text">' +
                                                '<input type="text" data-emojiable="true" class="mention" placeholder="Say Something..." id="chattext" onkeyup="sendChat(event, this);"  />' +
                                                '<button class="text-send" onclick="sendChat(event, this)">Send</button>' +
                                                '<div class="file-send">Drop Files</div>' +
                                                '<button class="record-send"><i class="fa fa-microphone" aria-hidden="true"></i></button>' +
                                            '</div>' +
                                       '</div>';
                        $('.all-chats').append(strChat);
                        // Append Old chats
                        // Identify sender/receiver
                        var loggedInUserId = getCookie('<%=JG_Prospect.Common.Cookies.UserId%>');
                        var str = '';
                        $(data.Object.ChatMessages).each(function (i) {
                            var senderReceiver = loggedInUserId == data.Object.ChatMessages[i].UserId ? 'sender' : 'receiver';
                            var fileid = data.Object.ChatMessages[i].FileId;
                            var msg = data.Object.ChatMessages[i].Message;
                            var previewImage = '<img src="/chat/attachments/' + msg.split(':-:')[1] + '" />';
                            var audioTag = '';
                            if (fileid != undefined && fileid != null && fileid != '') {
                                var fileExt = (msg.split(':-:')[0].split('.').pop()).toLowerCase();
                                switch (fileExt) {
                                    case 'xls':
                                    case 'xlsx':
                                        previewImage = '<img class="chat-image-preview" src="/chat/previewIcons/excel.png" />';
                                        break;
                                    case 'html':
                                    case 'html':
                                        previewImage = '<img class="chat-image-preview" src="/chat/previewIcons/html.png" />';
                                        break;
                                    case 'pdf':
                                        previewImage = '<img class="chat-image-preview" src="/chat/previewIcons/pdf.png" />';
                                        break;
                                    case 'txt':
                                    case 'rtf':
                                        previewImage = '<img class="chat-image-preview" src="/chat/previewIcons/text.png" />';
                                        break;
                                    case 'doc':
                                    case 'docx':
                                        previewImage = '<img class="chat-image-preview" src="/chat/previewIcons/word.png" />';
                                        break;
                                    case 'zip':
                                    case 'rar':
                                        previewImage = '<img class="chat-image-preview" src="/chat/previewIcons/zip.png" />';
                                        break;
                                    case 'mp3':
                                    case 'wav':
                                    case 'ogg':
                                        audioTag = '<audio controls><source src="/chat/attachments/' + msg.split(':-:')[1] + '"></audio>';
                                        break;
                                    case 'mp4':
                                    case 'webm':
                                        audioTag = '<video width="320" height="240" controls><source src="/chat/attachments/' + msg.split(':-:')[1] + '"></audio>';
                                        break;
                                    case 'png':
                                    case 'jpg':
                                    case 'bmp':
                                    case 'jpeg':
                                    case 'gif':
                                        previewImage = '<img src="/chat/attachments/' + msg.split(':-:')[1] + '" />';
                                        break;
                                    default:
                                        previewImage = '<img class="chat-image-preview" src="/chat/previewIcons/file.png" />';
                                        break;
                                }
                                if (audioTag != '') {
                                    msg = audioTag;
                                } else {
                                    msg = '<a href="/chat/attachments/' + msg.split(':-:')[1] + '" target="_black">' +
                                            previewImage +
                                            '</a>';
                                }
                            }
                            if (ValidURL(msg.trim())) {
                                var ext = (msg.split('.').pop()).toLowerCase();
                                switch (ext) {
                                    case 'xls':
                                    case 'xlsx':
                                        previewImage = '<img class="chat-image-preview" src="/chat/previewIcons/excel.png" />';
                                        break;
                                    case 'html':
                                    case 'html':
                                        previewImage = '<img class="chat-image-preview" src="/chat/previewIcons/html.png" />';
                                        break;
                                    case 'pdf':
                                        previewImage = '<img class="chat-image-preview" src="/chat/previewIcons/pdf.png" />';
                                        break;
                                    case 'txt':
                                    case 'rtf':
                                        previewImage = '<img class="chat-image-preview" src="/chat/previewIcons/text.png" />';
                                        break;
                                    case 'doc':
                                    case 'docx':
                                        previewImage = '<img class="chat-image-preview" src="/chat/previewIcons/word.png" />';
                                        break;
                                    case 'zip':
                                    case 'rar':
                                        previewImage = '<img class="chat-image-preview" src="/chat/previewIcons/zip.png" />';
                                        break;
                                    case 'mp3':
                                    case 'wav':
                                    case 'ogg':
                                        audioTag = '<audio controls><source src="' + msg + '"></audio>';
                                        break;
                                    case 'mp4':
                                    case 'webm':
                                        audioTag = '<video width="320" height="240" controls><source src="' + msg + '"></audio>';
                                        break;
                                    case 'png':
                                    case 'jpg':
                                    case 'bmp':
                                    case 'jpeg':
                                        previewImage = '<img src="' + msg + '" />';
                                        break;
                                    default:
                                        previewImage = msg;
                                        break;
                                }
                                if (audioTag != '') {
                                    msg = audioTag;
                                } else {
                                    msg = '<a href="' + msg + '" target="_black">' +
                                            previewImage +
                                            '</a>';
                                }
                            }
                            var tickColor = data.Object.ChatMessages[i].IsRead.toString().toLowerCase() == 'true' ? 'double-blue' : 'double-grey';
                            str += '<div class="chat-row ' + senderReceiver + '" userid="' + data.Object.ChatMessages[i].UserId + '"><div class="profile">' +
                                            '<img src="<%=baseUrl %>' + data.Object.ChatMessages[i].UserProfilePic + '" title="' + data.Object.ChatMessages[i].UserFullname + '" />' +
                                        '<div class="status-icon"></div><div class="installid">' +
                                            '<a target="_blank" href="/Sr_App/ViewSalesUser.aspx?id=' + data.Object.ChatMessages[i].UserId + '">' + data.Object.ChatMessages[i].UserInstallId + '</a></div>' +
                                    '</div>' +
                                    '<div class="message"><div class="msg">' + msg + '</div>' +
                                    '<div class="time-container"><div class="tick">' +
                                        '<img src="../img/' + tickColor + '-tick.png" /> </div>' +
                                        '<div class="time">' + data.Object.ChatMessages[i].MessageAtFormatted + '</div>' +
                                        '<div class="est">(EST)</div> </div>' +
                                    '</div></div>';
                        });
                        $('.chat-box#' + id + ' .chats').append(str);
                        //$('.chat-box .chats').scrollTop(d.prop("scrollHeight"));
                        $('.chat-box#' + id + ' .chats').animate({ scrollTop: $('.chat-box#' + id + ' .chats').prop("scrollHeight") }, 500);

                        GetOnlineUsers();
                        InitializeEmoji();
                        GetPhoneScripts(sender);
                        fillChatMemberList();
                    }
                }
            });
        }

        function bindChatUsers(data) {
            data.Results = data.Object.ActiveUsers;
            var total = 0;
            if (data.Results.length > 1) {
                // Get this(logged in user) from Cookie
                var loggedInUserId = getCookie('<%=JG_Prospect.Common.Cookies.UserId%>');
                var str = '';
                $.each(data.Results, function (i) {
                    total += data.Results[i].UnreadCount;
                    // remove this(loggedin) user from lits
                    if (loggedInUserId != data.Results[i].UserId) {
                        var clr = data.Results[i].IsRead.toString().toLowerCase() == 'true' ? 'double-blue' : 'double-grey';
                        var chatStatus = data.Results[i].OnlineAt == null ? 'offline' : (data.Results[i].Status == '1' ? 'active' : 'idle');
                        str += '<div title="' + data.Results[i].GroupOrUsername + '" class="user-row bg' + data.Results[i].InstallUserStatusId + '" uid="' + data.Results[i].UserId + '" onclick="InitiateChat(this, \'' + data.Results[i].ReceiverIds + '\', \'' + (data.Results[i].UserId == null ? data.Results[i].ChatGroupId : null) + '\',' + (parseInt(data.Results[i].TaskId) > 0 ? 2 : 10) + ',' + data.Results[i].TaskId + ',' + data.Results[i].TaskMultilevelListId + ',' + data.Results[i].UserChatGroupId + ')">' +
                                    '<div class="profile">' +
                                        '<img src="<%=baseUrl %>' + data.Results[i].ProfilePic + '" title="">' +
                                        (data.Results[i].UserId == null ? '' :
                                        '<div class="status-icon ' + chatStatus + '"></div>' +
                                        '<div class="installid"><a href="#">' + data.Results[i].UserInstallId + '</a></div>') +
                                        (parseInt(data.Results[i].UnreadCount) > 0 ? '<span class="unread-chat-count">' + data.Results[i].UnreadCount + '</span>' : '') +
                        '</div>' +
                        '<div class="contents" online-at="' + data.Results[i].OnlineAtFormatted + '">' +
                            '<div class="top"><div class="name">' + (data.Results[i].GroupNameAnchor == '' ? data.Results[i].GroupOrUsername : data.Results[i].GroupNameAnchor) + ' - <a target="_blank" onclick="event.stopPropagation();" href="/Sr_App/ViewSalesUser.aspx?id=' + data.Results[i].UserId + '" title="<%=baseUrl%>Sr_App/ViewSalesUser.aspx?id=' + data.Results[i].UserId + '">' + data.Results[i].UserInstallId + '</a></div>' +
                                '<div class="time">' + (data.Results[i].LastMessageAtFormatted == null ? '' : data.Results[i].LastMessageAtFormatted.split(' ')[0]) + '</div>' +
                                '<div class="last-login-time">' + ((data.Results[i].LastLoginAtFormatted != '' && data.Results[i].LastLoginAtFormatted != null) ? data.Results[i].LastLoginAtFormatted.split(' ')[0] : '') + '</div>' +
                                '</div>' +
                                        '<div class="msg-container">' +
                                            (data.Results[i].LastMessageAtFormatted == null ? '' :
                                            '<div class="tick"><img src="../img/' + clr + '-tick.png"></div>') +
                                            '<div class="msg">' + data.Results[i].LastMessage.split(':-:')[0] + '</div>' +
                                        '</div>' +
                                    '</div></div>';
                    }
                });
                $('.chat-users-section .list').html(str);
                // Bind Top Right Corner user list
                str = '';
                $.each(data.Results, function (i) {
                    // remove this(loggedin) user from lits
                    if (loggedInUserId != data.Results[i].UserId) {
                        var clr = data.Results[i].IsRead.toString().toLowerCase() == 'true' ? 'double-blue' : 'double-grey';
                        var chatStatus = data.Results[i].OnlineAt == null ? 'offline' : (data.Results[i].Status == '1' ? 'active' : 'idle');
                        str += '<div class="user-row row bg' + data.Results[i].InstallUserStatusId + '" title="' + data.Results[i].GroupOrUsername + '" uid="' + data.Results[i].UserId + '" onclick="InitiateChat(this, \'' + data.Results[i].ReceiverIds + '\', \'' + (data.Results[i].UserId == null ? data.Results[i].ChatGroupId : null) + '\',' + (parseInt(data.Results[i].TaskId) > 0 ? 2 : 10) + ',' + data.Results[i].TaskId + ',' + data.Results[i].TaskMultilevelListId + ',' + data.Results[i].UserChatGroupId + ')">' +
                                '<div class="user-image">' +
                                    '<div class="img">' +
                                        '<img src="<%=baseUrl %>' + data.Results[i].ProfilePic + '"></div>' +
                                    (data.Results[i].UserId == null ? '' :
		                            '<div class="status-icon ' + chatStatus + '"></div>' +
		                            '<div class="installid"><a href="javascript:;">' + data.Results[i].UserInstallId + '</a></div>') +
                                    ((data.Results[i].UnreadCount) > 0 ? '<span class="unread-chat-count">' + data.Results[i].UnreadCount + '</span>' : '') +
                                '</div>' +
	                            '<div class="contents">' +
		                            '<div class="top"><div class="name">' + (data.Results[i].GroupNameAnchor == '' ? data.Results[i].GroupOrUsername : data.Results[i].GroupNameAnchor) + ' - <a target="_blank" onclick="event.stopPropagation();" href="/Sr_App/ViewSalesUser.aspx?id=' + data.Results[i].UserId + '" title="<%=baseUrl%>Sr_App/ViewSalesUser.aspx?id=' + data.Results[i].UserId + '">' + data.Results[i].UserInstallId + '</a></div></div>' +
		                            '<div class="msg-container">' +
                                        (data.Results[i].LastMessageAtFormatted == null ? '' :
			                            '<div class="tick"><img src="../img/' + clr + '-tick.png"></div>') +
                                    '<div class="msg">' + data.Results[i].LastMessage.split(':-:')[0] + '</div>' +
		                            '</div>' +
	                            '</div>' +
	                            '<div class="caller">' +
		                            '<div class="phone"><i class="fa fa-phone" aria-hidden="true"></i></div>' +
		                            '<div class="email"><i class="fa fa-envelope" aria-hidden="true"></i></div>' +
		                            '<div class="video"><i class="fas fa-video" aria-hidden="true"></i></div>' +
                                    '<div class="mic"><i class="fas fa-microphone" aria-hidden="true"></i></div>' +
                                    '<div class="time">' + ((data.Results[i].LastMessageAtFormatted != '' && data.Results[i].LastMessageAtFormatted != null) ? data.Results[i].LastMessageAtFormatted.split(' ')[0] : '') + '</div>' +
                                    '<div class="last-login-time">' + ((data.Results[i].LastLoginAtFormatted != '' && data.Results[i].LastLoginAtFormatted != null) ? data.Results[i].LastLoginAtFormatted.split(' ')[0] : '') + '</div>' +
	                            '</div>' +
                            '</div>';
                        // add unread count to ITDashboard Notes if any
                        if (window.location.href.toLowerCase().indexOf('itdashboard.aspx') > 0) {
                            var taskId = data.Results[i].TaskId;
                            var taskMultilevelListId = data.Results[i].TaskMultilevelListId;
                            $('.notes-section').each(function () {
                                if ($(this).attr('taskid') == taskId && $(this).attr('taskmultilevellistid') == taskMultilevelListId) {
                                    if (data.Results[i].UnreadCount > 0) {
                                        $(this).find('span.unread-chat-count').remove();
                                        $(this).prepend('<span class="unread-chat-count">' + data.Results[i].UnreadCount + '</span>');
                                    } else {
                                        $(this).find('span.unread-chat-count').remove();
                                    }
                                }
                            });
                        }
                    }
                });
                if (total > 0) {
                    $('#hypChat').parent().find('#chatUnreadCount').show();
                    $('#hypChat').parent().find('#chatUnreadCount').html(total);
                } else {
                    $('#hypChat').parent().find('#chatUnreadCount').hide();
                }
                $('.header-msg').html(str);
                //GetChatUnReadCount();
            } else {
                $('.chat-users-section .list').html('<div class="no-user">No one is online!!!</div>');
                $('.header-msg').html('<div class="no-user">No one is online!!!</div>');
            }
            $('.header-msg').hover(function () {
                var H = ($(window).height() - 100) + 'px';
                $('.header-msg').css('height', H);
            }, function () {
                $('.header-msg').css('height', '158px');
            });
        }

        function SetChatMessageRead(data) {
            var chatGroupId = data.Object.split('`')[0];
            var isRead = data.Object.split('`')[1];
            var users = data.Message.split(',');
            if (isRead == '1') {
                $(users).each(function (i) {
                    $('#' + chatGroupId).find('.chat-row[userid="' + users[i] + '"]').find('.tick img').attr('src', '../img/double-blue-tick.png');
                    $('#' + chatGroupId).find('.chat-row[userid="' + users[i] + '"]').find('.tick').addClass('read');
                });
            }
            //GetChatUnReadCount();
        }

        function InitializeEmoji() {
            // Initializes and creates emoji set from sprite sheet
            window.emojiPicker = new EmojiPicker({
                emojiable_selector: '[data-emojiable=true]',
                assetsPath: '../Content/emoji-picker/lib/img/',
                popupButtonClasses: 'fas fa-smile'
            });
            // Finds all elements with `emojiable_selector` and converts them to rich emoji input fields
            // You may want to delay this step if you have dynamically created input fields that appear later in the loading process
            // It can be called as many times as necessary; previously converted input fields will not be converted again
            window.emojiPicker.discover();
            $('.emoji-wysiwyg-editor').attr({ 'onkeydown': "sendChat(event, this);", 'onkeyup': 'sendChatClear(event,this);' });
            $('.emoji-wysiwyg-editor').removeClass('target');
            $('.emoji-wysiwyg-editor').addClass('target');
            // Add @Mention
            //var existingText = $('input.mention').val();
            $('.emoji-wysiwyg-editor.mention').parent().find('.mentions').remove();
            $('.emoji-wysiwyg-editor.mention').parent().find('.mentions-autocomplete-list').remove();
            var existingUsers = $('.chat-box').find('#ReceiverIds').val();
            $('.emoji-wysiwyg-editor.mention').mentionsInput({
                onDataRequest: function (mode, query, callback) {
                    ajaxExt({
                        url: '/WebServices/JGWebService.asmx/GetUsers',
                        type: 'POST',
                        data: '{ keyword: "' + query + '", userChatGroupId:' + userTobeAddedIntoUserChatGroupId + ' }',
                        showThrobber: true,
                        throbberPosition: { my: "left center", at: "right center", of: $(this), offset: "5 0" },
                        success: function (data, msg) {
                            responseData = data.Results;
                            responseData = _.filter(responseData, function (item) {
                                return item.name.toLowerCase().indexOf(query.toLowerCase()) > -1
                            });
                            callback.call(this, responseData);
                        }
                    });
                }
            });
            //if (existingText != undefined && existingText != null) {
            //    $('input.mention').val(existingText);
            //}
            var file = $('.file-send');
            $(file).dropzone({
                clickable: true,
                maxFiles: 1,
                url: "/chat/ChatAttachmentUpload.aspx",
                thumbnailWidth: 30,
                thumbnailHeight: 30,
                init: function () {
                    dzClosure = this;
                    this.on("maxfilesexceeded", function (data) {
                        alert('you are reached maximum attachment upload limit.');
                    });
                    // when file is uploaded successfully store its corresponding server side file name to preview element to remove later from server.
                    this.on("success", function (file, response) {
                        var chatSourceId = $('.telecom-dashboard-popup').find('#ChatSourceId').val();
                        var taskId = $('.telecom-dashboard-popup').find('#TaskId').val();
                        var taskMultilevelListId = $('.telecom-dashboard-popup').find('#TaskMultilevelListId').val();
                        var userChatGroupId = $('.telecom-dashboard-popup').find('#UserChatGroupId').val();
                        if (chat.server == undefined)
                            chat = $.connection.chatHub;
                        // Success coding goes here
                        var filename = response.split("^");
                        var originalName = filename[2];
                        var displayName = filename[0];
                        var fileId = filename[1];
                        var chatId = $('.chat-box').find('#ChatGroupId').val();
                        var receiverIds = $('.chat-box').find('#ReceiverIds').val();
                        //$(file.previewTemplate).append('<span class="server_file">' + filename[0] + '</span>');
                        chat.server.sendChatMessage(chatId, '', chatSourceId, receiverIds, fileId, taskId, taskMultilevelListId, userChatGroupId);
                    });
                    this.on("complete", function (file) {
                        this.removeFile(file);
                    });
                }
            });
            //$('div.emoji-menu').off('click');
        }

        var emailTimer = setInterval(function () {
            var frame = document.getElementById('iframe-inbox');
            if (frame.contentWindow != null) {
                if ($("#iframe-inbox").contents().find("#email") != null && $("#iframe-inbox").contents().find("#email") != undefined) {
                    frame.contentWindow.postMessage('<%=UserId%>', '*');
                        clearInterval(emailTimer);
                    }
                }
        }, 6000);

            function sendChatClear(e, sender) {
                var charCode = (typeof e.which === "number") ? e.which : e.keyCode;
                if (charCode === 13) {
                    $(sender).html("");
                }
            }
            function minimizeEmail(sender) {
                if ($(sender).parents('.telecom-dashboard-popup').hasClass('fullscreen-email')) {
                    $(sender).parents('.telecom-dashboard-popup').removeClass('fullscreen-email');
                    $(sender).parents('.telecom-dashboard-popup').removeClass('fullscreen-chat');
                    $(sender).parents('.telecom-dashboard-popup').find('.call-logs').hide();
                    $('.popup-title').html('ALL-Telecom Dashboard');
                } else {
                    $(sender).parents('.telecom-dashboard-popup').addClass('fullscreen-email');
                    $(sender).parents('.telecom-dashboard-popup').removeClass('fullscreen-chat');
                    $(sender).parents('.telecom-dashboard-popup').find('.call-logs').hide();
                    $('.popup-title').html('Email Dashboard');
                }
            }

            $('.telecom-dashboard-popup').draggable({ handle: "div.header" })
                                         .resizable({
                                             stop: function (event, ui) {

                                             }
                                         })
            ;

            function attachFile(sender) {
                //   $('#form-attachment').find('input[type="file"]').trigger('click');
            }

            function minMax(sender) {
                $('.telecom-dashboard-popup').toggleClass('minimize');
                if ($('.telecom-dashboard-popup').hasClass('minimize')) {
                    $('.overlay').hide();
                } else {
                    $('.overlay').show();
                    RecenterChatPopup();
                }
            }

            function fullscreen(sender) {
                $('.telecom-dashboard-popup').toggleClass('fullscreen');
                if (!$('.telecom-dashboard-popup').hasClass('fullscreen')) {
                    RecenterChatPopup();
                }
            }

            function minMaxPhone(sender) {
                $('.phone-dashboard').toggleClass('minimize');
                if ($('.phone-dashboard').hasClass('minimize')) {
                    $('.overlay').hide();
                } else {
                    $('.overlay').show();
                    RecenterChatPopup();
                }
            }

            function fullscreenPhone(sender) {
                $('.phone-dashboard').toggleClass('fullscreen');
                if (!$('.phone-dashboard').hasClass('fullscreen')) {
                    RecenterChatPopup();
                }
            }

            function RecenterChatPopup() {
                // Calculate Center
                var sW = $(window).width();
                var pW = $('.telecom-dashboard-popup').width();
                var sH = $(window).height();
                var pH = $('.telecom-dashboard-popup').height();
                $('.telecom-dashboard-popup').css({ 'left': ((sW / 2) - (pW / 2)) + 'px', 'top': ((sH / 2) - (pH / 2)) + 'px' });

                pW = $('.phone-dashboard').width();
                pH = $('.phone-dashboard').height();
                $('.phone-dashboard').css({ 'left': ((sW / 2) - (pW / 2)) + 'px', 'top': ((sH / 2) - (pH / 2)) + 'px' });
                window.scrollTo(0, 0);
            }
            /*
            function GetChatUnReadCount() {
                ajaxExt({
                    url: '/WebServices/JGWebService.asmx/GetChatUnReadCount',
                    type: 'POST',
                    data: '{}',
                    showThrobber: false,
                    throbberPosition: { my: "left center", at: "right center", of: $(this), offset: "5 0" },
                    success: function (data, msg) {
                        var total = 0;
                        $.each(data.Results, function (i) {
                            total += data.Results[i].UnReadCount;
                            $('.chat-users-section .list .user-row[uid="' + data.Results[i].UserId + '"]')
                                    .find('.profile .unread-chat-count')
                                    .remove();
                            $('.header-msg .user-row[uid="' + data.Results[i].UserId + '"]')
                                    .find('.user-image .unread-chat-count')
                                    .remove();
                            if (data.Results[i].UnReadCount > 0) {
                                $('.chat-users-section .list .user-row[uid="' + data.Results[i].UserId + '"]')
                                        .find('.profile')
                                        .append('<span class="unread-chat-count">' + data.Results[i].UnReadCount + '</span>');
                                $('.header-msg .user-row[uid="' + data.Results[i].UserId + '"]')
                                        .find('.user-image')
                                        .append('<span class="unread-chat-count">' + data.Results[i].UnReadCount + '</span>');
                            }
                        });
                        if (total > 0) {
                            $('#hypChat').parent().find('#chatUnreadCount').show();
                            $('#hypChat').parent().find('#chatUnreadCount').html(total);
                        } else {
                            $('#hypChat').parent().find('#chatUnreadCount').hide();
                        }
                    }
                });
            }
            */
            var activePhoneScriptTabId = 0;
            function GetPhoneScripts(sender) {
                ajaxExt({
                    url: '/WebServices/JGWebService.asmx/GetPhoneScripts',
                    type: 'POST',
                    data: '{id:0}',
                    showThrobber: false,
                    throbberPosition: { my: "left center", at: "right center", of: $(sender), offset: "5 0" },
                    success: function (data, msg) {
                        scripts = data.Results;
                        if (activePhoneScriptTabId <= 0) {
                            $('.scrips .tabs').find('div:nth-child(2)').trigger('click');
                            $('.scrips .tabs').find('div:nth-child(2)').addClass('active');
                            $('.scrips .script-data .inner-tabs').find('div:nth-child(1)').trigger('click');
                            $('.scrips .script-data .inner-tabs').find('div:nth-child(1)').addClass('active');
                        } else {
                            $.each(scripts, function (i) {
                                $.each(scripts[i].SubTypes, function (j) {
                                    $.each(scripts[i].SubTypes[j].PhoneScripts, function (k) {
                                        if (scripts[i].SubTypes[j].PhoneScripts[k].Id == activePhoneScriptTabId) {
                                            $('.old-' + activePhoneScriptTabId).html(scripts[i].SubTypes[j].PhoneScripts[k].DescriptionPlain);
                                            $('.old-title-' + activePhoneScriptTabId).html(scripts[i].SubTypes[j].PhoneScripts[k].Title);
                                            $('.old-faq-' + activePhoneScriptTabId).html(scripts[i].SubTypes[j].PhoneScripts[k].FAQDescription);
                                            $('.old-faq-title-' + activePhoneScriptTabId).html(scripts[i].SubTypes[j].PhoneScripts[k].FAQTitle);
                                        }
                                    });
                                });
                            });
                            cancelUpdateScript(sender, activePhoneScriptTabId);
                            cancelUpdateScriptFAQ(sender, activePhoneScriptTabId);
                        }
                        activePhoneScriptTabId = 0;
                    }
                });
            }

            function GetOnlineUsers() {
                ajaxExt({
                    url: '/WebServices/JGWebService.asmx/InitiateBlankChat',
                    type: 'POST',
                    data: '{}',
                    showThrobber: false,
                    throbberPosition: { my: "left center", at: "right center", of: $(this), offset: "5 0" },
                    success: function (data, msg) {
                        var obj = {
                            Object: { ActiveUsers: data.Results }
                        };
                        bindChatUsers(obj);
                    }
                });
            }

            function InitiateBlankChat(sender, box) {
                ajaxExt({
                    url: '/WebServices/JGWebService.asmx/InitiateBlankChat',
                    type: 'POST',
                    data: '{}',
                    showThrobber: true,
                    throbberPosition: { my: "left center", at: "right center", of: $(sender), offset: "5 0" },
                    success: function (data, msg) {
                        // Close Previous Chat
                        $('.call-logs').hide();
                        var chat = $('.chat-container .chat-box').find('span.close');
                        closechat(chat);
                        $('.telecom-dashboard-popup').show();
                        $('.overlay').show();
                        RecenterChatPopup();
                        var obj = {
                            Object: { ActiveUsers: data.Results }
                        };
                        bindChatUsers(obj);
                        //GetChatUnReadCount();
                        GetPhoneScripts(sender);
                        switch (box) {
                            case 'email':
                                $('.email-section').find('.minimize').trigger('click');
                                break;
                            case 'chat':
                                $('.telecom-dashboard-popup').removeClass('fullscreen-email');
                                $('.telecom-dashboard-popup').removeClass('fullscreen-phone');
                                $('.telecom-dashboard-popup').addClass('fullscreen-chat');
                                $('.telecom-dashboard-popup').find('.popup-title').html('Chat Dashboard');
                                $('.chat-users-section .list > div:nth-child(1)').trigger('click');
                                break;
                            case 'phone':
                                //GetPhoneScripts(sender);
                                $('.call-logs').show();
                                $('.telecom-dashboard-popup').removeClass('fullscreen-email');
                                $('.telecom-dashboard-popup').removeClass('fullscreen-chat');
                                $('.telecom-dashboard-popup').addClass('fullscreen-phone');
                                $('.telecom-dashboard-popup').find('.popup-title').html('Phone / VMail Dashboard');
                                break;
                            case 'all':
                                $('.telecom-dashboard-popup').removeClass('fullscreen-email');
                                $('.telecom-dashboard-popup').removeClass('fullscreen-chat');
                                $('.telecom-dashboard-popup').removeClass('fullscreen-phone');
                                $('.telecom-dashboard-popup').find('.popup-title').html('All Telecom Dashboard');
                                $('.chat-users-section .list > div:nth-child(1)').trigger('click');
                                break;
                        }
                    }
                });
            }
            var scripts = [];
            function showhideScript(sender) {
                var id = $(sender).attr('id');
                if ($(sender).parent().find('.desc#' + id).is(':visible')) {
                    $(sender).parent().find('.desc#' + id).slideUp();
                } else {
                    $(sender).parent().find('.desc#' + id).slideDown();
                }
            }
            function showhideType(sender, type) {
                var innerTabs = '';
                var subscrips = [];
                $('.scrips .tabs').find('div').removeClass('active');
                $(sender).addClass('active');
                $('.script-data .inner-tabs').find('div:nth-child(1)').addClass('active');
                $.each(scripts, function (i) {
                    if (scripts[i].Type == type) {
                        subscrips = scripts[i].SubTypes;
                        $.each(subscrips, function (j) {
                            innerTabs += '<div onclick="SetScriptContent(this,' + subscrips[j].Type + ',' + subscrips[j].SubType + ')" parentId="' + subscrips[j].SubType + '">' + subscrips[j].SubTypeName + '</div>';
                        });
                        $('.script-data .inner-tabs').html(innerTabs);
                    }
                });
                $('.script-data .content').html('');
            }
            function SetScriptContent(sender, type, subType) {
                $('.script-data .inner-tabs > div').removeClass('active');
                $(sender).addClass('active');
                var scriptContents = [];
                var content = '';
                $.each(scripts, function (i) {
                    if (scripts[i].Type == type) {
                        $.each(scripts[i].SubTypes, function (j) {
                            if (scripts[i].SubTypes[j].Type == type && scripts[i].SubTypes[j].SubType == subType) {
                                scriptContents = scripts[i].SubTypes[j].PhoneScripts;
                                $.each(scriptContents, function (k) {
                                    content += '<div class="content-row"><div class="content-items active" pid="' + scriptContents[k].Id + '"><div class="title" onclick="showhideSubType(this)">' + scriptContents[k].Title + '</div><div class="script-content">' + scriptContents[k].DescriptionPlain + '</div><div class="edit-link"><a href="javascript:;" onclick="editScript(this,' + scriptContents[k].Id + ')">Edit</a></div></div>' +
                                                '<div class="content-items-right active" pid="' + scriptContents[k].Id + '"><div class="title" onclick="showhideSubTypeFAQ(this)">' + scriptContents[k].FAQTitle + '</div><div class="script-content">' + scriptContents[k].FAQDescription + '</div><div class="edit-link"><a href="javascript:;" onclick="editScriptFAQ(this,' + scriptContents[k].Id + ')">Edit</a></div></div>' +
                                                '</div>';
                                });
                                $('.script-data .content').html(content);
                            }
                        });
                    }
                });
            }

            function editScript(sender, id) {
                var script = $(sender).parents('.content-items').find('div:nth-child(2)').html();
                var title = $(sender).parents('.content-items').find('div:nth-child(1)').html();
                $(sender).parents('.content-items').find('div.script-content').show();
                $(sender).parents('.content-items').find('div.script-content').html('<span style="display:none;" class="old-title-' + id + '">' + title + '</span><span style="display:none;" class="old-' + id + '">' + script + '</span><input type="text" value="' + title + '" /><textarea id="script-' + id + '">' + script + '</textarea><input type="button" value="Save" onclick="updateScript(this,' + id + ')"/><input type="button" class="cancel" value="Cancel" onclick="cancelUpdateScript(this,' + id + ')"/>');
                $(sender).parents('.content-items').find('div.title').hide();
                SetCKEditorForTaskPopup('script-' + id);
            }

            function cancelUpdateScript(sender, id) {
                //GetCKEditorContent();
                var old = $('.old-' + id).html();
                var oldTitle = $('.old-title-' + id).html();
                $(sender).parents('.content-items').find('div.title').html(oldTitle).show();
                $(sender).parents('.content-items').find('div.script-content').html(old).hide();

            }

            function editScriptFAQ(sender, id) {
                var script = $(sender).parents('.content-items-right').find('div:nth-child(2)').html();
                var title = $(sender).parents('.content-items-right').find('div:nth-child(1)').html();
                $(sender).parents('.content-items-right').find('div.script-content').show();
                $(sender).parents('.content-items-right').find('div.script-content').html('<span style="display:none;" class="old-faq-title-' + id + '">' + title + '</span><span style="display:none;" class="old-faq-' + id + '">' + script + '</span><input type="text" value="' + title + '" /><textarea id="script-faq-' + id + '">' + script + '</textarea><input type="button" value="Save" onclick="updateScriptFAQ(this,' + id + ')"/><input type="button" class="cancel" value="Cancel" onclick="cancelUpdateScriptFAQ(this,' + id + ')"/>');
                $(sender).parents('.content-items-right').find('div.title').hide();
                SetCKEditorForTaskPopup('script-faq-' + id);
            }
            function cancelUpdateScriptFAQ(sender, id) {
                //GetCKEditorContent();
                var old = $('.old-faq-' + id).html();
                var oldTitle = $('.old-faq-title-' + id).html();
                $(sender).parents('.content-items-right').find('div.title').html(oldTitle).show();
                $(sender).parents('.content-items-right').find('div.script-content').html(old).hide();

            }
            function updateScript(sender, id) {
                var desc = GetCKEditorContent('script-' + id).replace(/"/g, '\\"');
                var title = $(sender).parents('.script-content').find('input[type="text"]').val().trim();
                ajaxExt({
                    url: '/WebServices/JGWebService.asmx/UpdatePhoneScript',
                    type: 'POST',
                    data: '{id:' + id + ',title:"' + title + '",desc:"' + desc + '"}',
                    showThrobber: true,
                    throbberPosition: { my: "left center", at: "right center", of: $(sender), offset: "5 0" },
                    success: function (data, msg) {
                        activePhoneScriptTabId = id;
                        GetPhoneScripts(sender);
                    }
                });
            }

            function updateScriptFAQ(sender, id) {
                var desc = GetCKEditorContent('script-faq-' + id).replace(/"/g, '\\"');
                var title = $(sender).parents('.script-content').find('input[type="text"]').val().trim();
                ajaxExt({
                    url: '/WebServices/JGWebService.asmx/UpdatePhoneScriptFAQ',
                    type: 'POST',
                    data: '{id:' + id + ',title:"' + title + '",desc:"' + desc + '"}',
                    showThrobber: true,
                    throbberPosition: { my: "left center", at: "right center", of: $(sender), offset: "5 0" },
                    success: function (data, msg) {
                        activePhoneScriptTabId = id;
                        GetPhoneScripts(sender);
                    }
                });
            }

            function showhideSubType(sender) {
                var id = $(sender).attr('id');
                if ($(sender).parents('.content-items').hasClass('active')) {
                    $(sender).parents('.content-items').removeClass('active')
                } else {
                    $(sender).parents('.content-items').addClass('active')
                }
            }
            function showhideSubTypeFAQ(sender) {
                var id = $(sender).attr('id');
                if ($(sender).parents('.content-items-right').hasClass('active')) {
                    $(sender).parents('.content-items-right').removeClass('active')
                } else {
                    $(sender).parents('.content-items-right').addClass('active')
                }
            }
            function minimizePhone(sender) {
                if ($(sender).parents('.telecom-dashboard-popup').hasClass('fullscreen-phone')) {
                    $(sender).parents('.telecom-dashboard-popup').removeClass('fullscreen-phone');
                    $(sender).parents('.telecom-dashboard-popup').removeClass('fullscreen-email');
                    $(sender).parents('.telecom-dashboard-popup').removeClass('fullscreen-chat');
                    $(sender).parents('.telecom-dashboard-popup').find('.call-logs').hide();
                    $('.popup-title').html('ALL-Telecom Dashboard');
                } else {
                    $(sender).parents('.telecom-dashboard-popup').addClass('fullscreen-phone');
                    $(sender).parents('.telecom-dashboard-popup').removeClass('fullscreen-email');
                    $(sender).parents('.telecom-dashboard-popup').removeClass('fullscreen-chat');
                    $(sender).parents('.telecom-dashboard-popup').find('.call-logs').hide();
                    $('.popup-title').html('Phone / Vmail Dashboard');
                }

                //if ($('.call-logs').is(':visible')) {
                //    $('.call-logs').hide();
                //    $('.telecom-dashboard-popup').find('.popup-title').html('All Telecom Dashboard');
                //} else {
                //    //GetPhoneScripts(sender);
                //    $('.call-logs').show();
                //    $('.telecom-dashboard-popup').find('.popup-title').html('Phone / Vmail Dashboard');
                //}
            }

            function loadEmailIFrame() {
                $("#iframe-inbox").attr("src", "https://web.jmgrovebuildingsupply.com/email/default.aspx");
                setTimeout(function () {
                    $("#iframe-inbox").attr("src", "https://web.jmgrovebuildingsupply.com/email/default.aspx");
                }, 3000);
            }
            function fillChatMemberList() {
                ajaxExt({
                    url: '/WebServices/JGWebService.asmx/GetChatGroupMembers',
                    type: 'POST',
                    data: '{UserChatGroupId:' + $('.chat-box').find('#UserChatGroupId').val() + ',SenderUserId:"' + $('.chat-box').find('#ReceiverIds').val() + '"}',
                    showThrobber: false,
                    success: function (data, msg) {
                        var str = '';
                        $.each(data.Results, function (i) {
                            str += '<div class="row"><div>' + data.Results[i].GroupOrUsername + '</div><div title="remove" onclick="removeMember(this,' + data.Results[i].UserId + ')"><i class="fas fa-trash-alt"></i></div></div>';
                        });
                        //var receivers = $('.chat-box').find('#ReceiverIds').val().split(',');
                        str += '<div class="row leave-group"><div onclick="leaveGroup(this)">Leave Group</div></div>';
                        if (str != '' && parseInt($('.chat-box').find('#UserChatGroupId').val()) > 0/* && receivers.length > 1*/) {
                            $('.member-list-container div.member-list').html(str);
                            $('.member-list-container').show();
                        } else if (parseInt($('.chat-box').find('#UserChatGroupId').val()) <= 0) {
                            $('.member-list-container').hide();
                            $('.chat-box').find('.last-seen').html(data.Message);
                        }
                    }
                });
            }
            var phonePopupHeight = 0;
            function openPhoneDashboard(sender) {
                $('.telecom-dashboard-popup').hide();
                $('.overlay').show();
                $('.phone-dashboard').show();
                // Calculate Center
                var sW = $(window).width();
                var pW = $('.phone-dashboard').width();
                var sH = $(window).height();
                $('.phone-dashboard').css('height', (sH - 50) + 'px');
                var pH = $('.phone-dashboard').height();
                $('.phone-dashboard iframe').css('height', (pH - 42) + 'px');
                phonePopupHeight = pH;
                //$('.auto-dialer-bottom-section').css('height', (pH - 320) + 'px');

                $('.phone-dashboard').css({ 'left': ((sW / 2) - (pW / 2)) + 'px', 'top': ((sH / 2) - (pH / 2)) + 'px' });
                $('.phone-dashboard').find('iframe').attr('src', '/sr_app/autodialer.aspx');
            }

            function closePhonePopup(sender) {
                $('.overlay').hide();
                $('.phone-dashboard').hide();
            }
            $(document).ready(function () {
                //loadEmailIFrame();
                //if (window.location.href.toLowerCase().indexOf('autodialer.aspx') <= 0) {
                //    GetPhoneScripts(this);
                //    $('.search-user').trigger('click');
                //    resetSettings();
                //    initPhone();
                //}
            });
            
    </script>

</body>

</html>
